<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4 bg-light">
  <h2>Admin Dashboard ðŸ‘‘</h2>
  <a href="{{ url_for('logout') }}" class="btn btn-danger float-end">Logout</a>

  <div class="mt-4">
    <h4>Add New Task</h4>
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        {% for msg in messages %}
          <div class="alert alert-success">{{ msg }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}
    <form method="POST" action="{{ url_for('add_task') }}">
      <div class="mb-3">
        <label for="title" class="form-label">Task Title</label>
        <input type="text" class="form-control" name="title" required>
      </div>
      <div class="mb-3">
        <label for="desc" class="form-label">Description</label>
        <textarea class="form-control" name="desc" rows="2" required></textarea>
      </div>
      <div class="mb-3">
        <label for="user" class="form-label">Assign To</label>
        <select class="form-select" name="user" required>
          {% for u in users %}
            <option value="{{ u[1] }}">{{ u[1] }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="mb-3">
        <label for="status" class="form-label">Status</label>
        <select class="form-select" name="status" required>
          <option value="Pending">Pending</option>
          <option value="Completed">Completed</option>
        </select>
      </div>
      <button type="submit" class="btn btn-success">Add Task</button>
    </form>
  </div>

  <hr class="my-4">

  <h4>All Tasks</h4>
<table class="table table-bordered mt-3">
<thead>
<tr><th>ID</th><th>Title</th><th>User</th><th>Status</th><th>Admin Decision</th><th>Action</th></tr>
</thead>
<tbody>
{% for t in tasks %}
<tr>
<td>{{ t[0] }}</td>
<td>{{ t[1] }}</td>
<td>{{ t[3] }}</td>
<td>
    {% if t[5] == 'Uploaded' %}
        <span class="badge bg-warning text-dark">{{ t[5] }}</span>
    {% else %}
        <span class="badge bg-secondary">{{ t[5] }}</span>
    {% endif %}
</td>
<td>
    {% if t[6] %}
        <span class="badge {{ 'bg-success' if t[6]=='Accepted' else 'bg-danger' }}">{{ t[6] }}</span>
    {% else %}
        <span class="badge bg-secondary">Pending</span>
    {% endif %}
</td>
<td>
    {% if t[5]=='Uploaded' %}
        <form style="display:inline" method="POST" action="{{ url_for('admin_decision', task_id=t[0], decision='Accepted') }}">
            <button type="submit" class="btn btn-sm btn-success">Accept</button>
        </form>
        <form style="display:inline" method="POST" action="{{ url_for('admin_decision', task_id=t[0], decision='Rejected') }}">
            <button type="submit" class="btn btn-sm btn-danger">Reject</button>
        </form>
    {% else %}
        <span class="text-muted">No action</span>
    {% endif %}
</td>
</tr>
{% endfor %}
</tbody>
</table>
</body>
</html>
